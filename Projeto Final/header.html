<!DOCTYPE html>
<html>
<head>
		<title> HEADER </title>
		<link rel="stylesheet" href="css/dc.css">
		<link rel="stylesheet" href="css/styles.css">
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css"/>
		<script src="js/crossfilter.js" charset="utf-8"></script>
		<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script src="js/dc.js" charset="utf-8"></script>
		<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>

	    <style type="text/css">  </style>		      
		   
</head>
<body>

 <p class="well lead">Teste<br/> 
 <div id="chart1"></div>


	<script type="text/javascript">

      var barChart1 = dc.barChart('#chart1');

      var authorMap = {}

      var loadDSV = function(file){

		var dsv = d3.dsv(";","text/plain");
		dsv(file, function(data){

	            var dtgFormat = d3.time.format("%Y-%m-%d %H:%M:%S"); // ex: 2013-08-17 19:52:50
	            data.forEach(function(d){

      			d.AnoAtendimento = +d.AnoAtendimento;
      			d.TrimestreAtendimento = +d.TrimestreAtendimento;
      			d.MesAtendimento = +d.MesAtendimento;
      			d.DataAtendimentoFormatado = dtgFormat.parse( d.DataAtendimento.substr(0,18) ); 
      			d.CodigoRegiao = +d.CodigoRegiao;
      			d.Regiao = d.Regiao;
      			d.UF = d.UF;
      			d.CodigoTipoAtendimento = +d.CodigoTipoAtendimento;
      			d.DescricaoTipoAtendimento = d.DescricaoTipoAtendimento;
      			d.CodigoAssunto = +d.CodigoAssunto;
      			d.DescricaoAssunto = d.DescricaoAssunto;
      			d.GrupoAssunto = d.GrupoAssunto;
      			d.CodigoProblema = +d.CodigoProblema;
      			d.DescricaoProblema = d.DescricaoProblema;
      			d.GrupoProblema = d.GrupoProblema;
      			d.SexoConsumidor = d.SexoConsumidor;
      			d.FaixaEtariaConsumidor = d.FaixaEtariaConsumidor;
      			d.CEPConsumidor = +d.CEPConsumidor;
                        d.TipoFornecedor = +d.TipoFornecedor;
                        d.RazaoSocialSindec = d.RazaoSocialSindec;
                        d.NomeFantasiaSindec = d.NomeFantasiaSindec;
                        d.CNPJ = +d.CNPJ;
                        d.RadicalCNPJ = +d.RadicalCNPJ;
                        d.RazaoSocialRFB = d.RazaoSocialRFB;
                        d.NomeFantasiaRFB = d.NomeFantasiaRFB;
                        d.CodigoCNAEPrincipal = +d.CodigoCNAEPrincipal;
                        d.DescricaoCNAEPrincipal = d.DescricaoCNAEPrincipal;

	            });

                  //criando um crossfilter
                  var facts = crossfilter(data);

                  console.log(facts.all()); //all() retorna todos os registros brutos

                  // DIMENSIONS AND GROUPS

                  var AnoAtendimentoDim = facts.dimension(function(d){
                        return d.AnoAtendimento;
                  });
                  var AnoAtendimentoGroup = AnoAtendimentoDim.group();

                  var TrimestreAtendimentoDim = facts.dimension(function(d){
                        return d.TrimestreAtendimento;
                  });
                  var TrimestreAtendimentoGroup = TrimestreAtendimentoDim.group();

                  var MesAtendimentoDim = facts.dimension(function(d){
                        return d.MesAtendimento;
                  });
                  var MesAtendimentoGroup = MesAtendimentoDim.group();

                  var HourDim = facts.dimension(function(d){
                        return d3.time.hour( d.DataAtendimentoFormatado );
                  });
                  var HourGroup = HourDim.group();

                  var CodigoRegiaoDim = facts.dimension(function(d){
                        return d.CodigoRegiao ;
                  });
                  var CodigoRegiaoGroup = CodigoRegiaoDim.group();

                  var RegiaoDim = facts.dimension(function(d){
                        return d.Regiao;
                  });
                  var RegiaoGroup = RegiaoDim.group();

                  var UFDim = facts.dimension(function(d){
                        return d.UF;
                  });
                  var UFGroup = UFDim.group();

                  var CodigoTipoAtendimentoDim = facts.dimension(function(d){
                        return d.CodigoTipoAtendimento;
                  });
                  var CodigoTipoAtendimentoGroup = CodigoTipoAtendimentoDim.group();

                  var DescricaoTipoAtendimentoDim = facts.dimension(function(d){
                        return d.DescricaoTipoAtendimento;
                  });
                  var DescricaoTipoAtendimentoGroup = DescricaoTipoAtendimentoDim.group();

                  var CodigoAssuntoDim = facts.dimension(function(d){
                        return d.CodigoAssunto;
                  });
                  var CodigoAssuntoGroup = CodigoAssuntoDim.group();

                  var GrupoAssuntoDim = facts.dimension(function(d){
                        return d.GrupoAssunto;
                  });
                  var GrupoAssuntoGroup = GrupoAssuntoDim.group();

                  var CodigoProblemaDim = facts.dimension(function(d){
                        return d.CodigoProblema;
                  });
                  var CodigoProblemaGroup = CodigoProblemaDim.group();

                  var DescricaoProblemaDim = facts.dimension(function(d){
                        return d.DescricaoProblema;
                  });
                  var DescricaoProblemaGroup = DescricaoProblemaDim.group();

                  var GrupoProblemaDim = facts.dimension(function(d){
                        return d.GrupoProblema;
                  });
                  var GrupoProblemaGroup = GrupoProblemaDim.group();

                  var SexoConsumidorDim = facts.dimension(function(d){
                        return d.SexoConsumidor;
                  });
                  var SexoConsumidorGroup = SexoConsumidorDim.group();

                  var FaixaEtariaConsumidorDim = facts.dimension(function(d){
                        return d.FaixaEtariaConsumidor;
                  });
                  var FaixaEtariaConsumidorGroup = FaixaEtariaConsumidorDim.group();

                  var CEPConsumidorDim = facts.dimension(function(d){
                        return d.CEPConsumidor;
                  });
                  var CEPConsumidorGroup = CEPConsumidorDim.group();

                  var TipoFornecedorDim = facts.dimension(function(d){
                        return d.TipoFornecedor;
                  });
                  var TipoFornecedorGroup = TipoFornecedorDim.group();

                  var RazaoSocialSindecDim = facts.dimension(function(d){
                        return d.RazaoSocialSindec; 
                  });
                  var RazaoSocialSindecGroup = RazaoSocialSindecDim.group();

                  var NomeFantasiaSindecDim = facts.dimension(function(d){
                        return d.NomeFantasiaSindec; 
                  });
                  var NomeFantasiaSindecGroup = NomeFantasiaSindecDim.group();

                  var CNPJDim = facts.dimension(function(d){
                        return d.CNPJ; 
                  });
                  var CNPJGroup = CNPJDim.group();

                  var RadicalCNPJDim = facts.dimension(function(d){
                        return d.RadicalCNPJ; 
                  });
                  var RadicalCNPJGroup = RadicalCNPJDim.group();

                  var RazaoSocialRFBDim = facts.dimension(function(d){
                        return d.RazaoSocialRFB; 
                  });
                  var RazaoSocialRFBGroup = RazaoSocialRFBDim.group();
                  
                  var NomeFantasiaRFBDim = facts.dimension(function(d){
                        return d.NomeFantasiaRFB; 
                  });
                  var NomeFantasiaRFBGroup = NomeFantasiaRFBDim.group();

                  var CodigoCNAEPrincipalDim = facts.dimension(function(d){
                        return d.CodigoCNAEPrincipal; 
                  });
                  var CodigoCNAEPrincipalGroup = CodigoCNAEPrincipalDim.group();

                  var DescricaoCNAEPrincipalDim = facts.dimension(function(d){
                        return d.DescricaoCNAEPrincipal; 
                  });
                  var DescricaoCNAEPrincipalGroup = DescricaoCNAEPrincipalDim.group();

                  barChart1 /* dc.barChart('#volume-month-chart', 'chartGroup') */
                      .width(450)
                      .height(500)
                      .margins({top: 10, right: 50, bottom: 20, left: 40})
                      .dimension(UFDim)
                      .group(UFGroup)
                      .gap(5)
                      .x(d3.scale.ordinal().domain( ['DF', 'SP'] ))
                     // .xUnits(dc.units.ordinal)
                      .renderHorizontalGridLines(true)
            

                      dc.renderAll();



            });

      

      loadDSV("Teste1.csv");
      //loadDSV("Teste2.csv");

	</script>			
</body>
</html>
